\listfiles

\documentclass[a4paper]{article}

\usepackage{luacode}
\usepackage{longtable}

% provide clean console output
\hfuzz=2000pt
\hbadness=10000

\newcommand{\marktime}{\directlua{table.insert(times, os.time())}}

\newcommand{\lorem}{Curabitur dictum gravida mauris. Nam arcu libero, nonummy
  eget, consectetuer id, vulputate a, magna. Donec vehicula augue eu
  neque. Pellentesque habitant morbi tristique senectus et netus et malesuada
  fames ac turpis egestas. Mauris ut leo. Cras viverra metus rhoncus sem. Nulla
  et lectus vestibulum urna fringilla ultrices. Phasellus eu tellus sit amet
  tortor gravida placerat.}

\begin{document}

\begin{luacode*}

  times = {}
  print(start)
  for j = 0, 800 do
     tex.print("\\input{testcase} ")
  end

\end{luacode*}


\begin{luacode}

  local theformat = "%4s %8s %8s"
  local header = string.format(theformat, "Num", "Lap", "Total")

  print()
  print(header)

  local start = times[1]
  local last = start

  for k, v in pairs(times) do

  if k % 100 == 0 then
     local now = v - last
     local line = string.format(theformat, k, now, v-start)
     print(line); last = v
  end
  end

\end{luacode}

\end{document}

